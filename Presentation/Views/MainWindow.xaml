<Window x:Class="CSharp_WPF_Websockets.Presentation.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="clr-namespace:CSharp_WPF_Websockets.Presentation.Views"
        mc:Ignorable="d"
        Icon="/Resources/Assets/logo.png"
        Title="WS SCope" Height="900" Width="1600"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Background="Transparent"
        TextOptions.TextFormattingMode="Display"
        UseLayoutRounding="True">

    <Window.Resources>
        <SolidColorBrush x:Key="BgDeep" Color="#FFF5F7FA"/>
        <SolidColorBrush x:Key="BgCard" Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="BgHover" Color="#FFF0F2F5"/>

        <SolidColorBrush x:Key="AccentColor" Color="#FF0984E3"/>
        <SolidColorBrush x:Key="AccentLight" Color="#EBF5FB"/>
        <SolidColorBrush x:Key="ErrorColor" Color="#D63031"/>
        <SolidColorBrush x:Key="SuccessColor" Color="#00B894"/>

        <SolidColorBrush x:Key="BorderColor" Color="#E2E8F0"/>

        <SolidColorBrush x:Key="TextPrimary" Color="#FF2D3436"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#FF636E72"/>
        <SolidColorBrush x:Key="TextMuted" Color="#FFB2BEC3"/>

        <DropShadowEffect x:Key="CardShadow" BlurRadius="10" ShadowDepth="2" Direction="270" Color="#DCE1E6" Opacity="0.5"/>
        <DropShadowEffect x:Key="HeaderShadow" BlurRadius="5" ShadowDepth="1" Direction="270" Color="#DCE1E6" Opacity="0.3"/>

        <Style TargetType="{x:Type ScrollBar}">
            <Setter Property="Stylus.IsPressAndHoldEnabled" Value="false"/>
            <Setter Property="Stylus.IsFlicksEnabled" Value="false"/>
            <Setter Property="Width" Value="10"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollBar}">
                        <Grid x:Name="Bg" SnapsToDevicePixels="true">
                            <Track x:Name="PART_Track" IsDirectionReversed="true">
                                <Track.Thumb>
                                    <Thumb>
                                        <Thumb.Style>
                                            <Style TargetType="{x:Type Thumb}">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="{x:Type Thumb}">
                                                            <Border Background="#CBD5E0" CornerRadius="4"/>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Background" Value="#A0AEC0"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Thumb.Style>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="LayoutButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="Width" Value="36"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bdr" Background="{TemplateBinding Background}" 
                                BorderBrush="{StaticResource AccentColor}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bdr" Property="Background" Value="#E2E8F0"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bdr" Property="Background" Value="#CBD5E0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="IconPath" TargetType="Path">
            <Setter Property="Fill" Value="{StaticResource TextSecondary}"/>
            <Setter Property="Stretch" Value="Uniform"/>
            <Setter Property="Height" Value="16"/>
            <Setter Property="Width" Value="16"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=Button}}" Value="True">
                    <Setter Property="Fill" Value="{StaticResource AccentColor}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="20,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="brd" Background="{TemplateBinding Background}" CornerRadius="6" Effect="{StaticResource HeaderShadow}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="brd" Property="Background" Value="#FF0A75C9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="brd" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.98" ScaleY="0.98"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- BOTÓN SECUNDARIO (STOP/REFRESH) -->
        <Style x:Key="GhostButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="brd" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="brd" Property="Background" Value="{StaticResource BgHover}"/>
                                <Setter TargetName="brd" Property="BorderBrush" Value="{StaticResource TextSecondary}"/>
                                <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- INPUT TEXTBOX -->
        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="bd" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="bd" Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                                <Setter TargetName="bd" Property="BorderThickness" Value="1.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <Grid Background="{StaticResource BgDeep}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="33*"/>
            <ColumnDefinition Width="767*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Content -->
            <RowDefinition Height="40"/>
            <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- 1. HEADER BAR -->
        <Border Grid.Row="0" Background="{StaticResource BgCard}" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1" Padding="20,15" Effect="{StaticResource HeaderShadow}" Grid.ColumnSpan="2">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <!-- Title -->
                    <ColumnDefinition Width="*"/>
                    <!-- Spacer -->
                    <ColumnDefinition Width="Auto"/>
                    <!-- Controls -->
                </Grid.ColumnDefinitions>

                <!-- LOGO & TITULO -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Border Background="{StaticResource AccentColor}" CornerRadius="4" Width="8" Height="24" Margin="0,0,12,0"/>
                    <TextBlock Text="WS" FontWeight="Bold" FontSize="22" Foreground="{StaticResource TextPrimary}"/>
                    <TextBlock Text="Scope" FontWeight="Regular" FontSize="22" Foreground="{StaticResource TextSecondary}" Margin="6,0,0,0"/>
                </StackPanel>

                <!-- CONTROLES -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">

                    <!-- SELECTOR DE LAYOUT (MATRICES) -->
                    <Border Background="{StaticResource BgHover}" CornerRadius="8" Padding="4" Margin="0,0,30,0">
                        <StackPanel Orientation="Horizontal">
                            <!-- 1 Columna (Cuadrado lleno) -->
                            <Button Style="{StaticResource LayoutButton}" Command="{Binding SetGridColumnsCommand}" CommandParameter="1" ToolTip="Single View">
                                <Path Style="{StaticResource IconPath}" Data="M2,2 H14 V14 H2 Z"/>
                            </Button>
                            <!-- 2 Columnas (Dos barras verticales) -->
                            <Button Style="{StaticResource LayoutButton}" Command="{Binding SetGridColumnsCommand}" CommandParameter="2" ToolTip="Split View">
                                <Path Style="{StaticResource IconPath}" Data="M2,2 H7 V14 H2 Z M9,2 H14 V14 H9 Z"/>
                            </Button>
                            <!-- 3 Columnas (Grid 3x3 simplificado - 3 columnas) -->
                            <Button Style="{StaticResource LayoutButton}" Command="{Binding SetGridColumnsCommand}" CommandParameter="3" ToolTip="Grid View (3)">
                                <Path Style="{StaticResource IconPath}" Data="M1,2 H5 V14 H1 Z M6,2 H10 V14 H6 Z M11,2 H15 V14 H11 Z"/>
                            </Button>
                            <!-- 4 Columnas (Grid Matriz 2x2) -->
                            <Button Style="{StaticResource LayoutButton}" Command="{Binding SetGridColumnsCommand}" CommandParameter="4" ToolTip="Matrix View (4)">
                                <Path Style="{StaticResource IconPath}" Data="M1,1 H7 V7 H1 Z M9,1 H15 V7 H9 Z M1,9 H7 V15 H1 Z M9,9 H15 V15 H9 Z"/>
                            </Button>
                        </StackPanel>
                    </Border>

                    <!-- CONEXIÓN -->
                    <TextBlock Text="IP Address" VerticalAlignment="Center" Foreground="{StaticResource TextSecondary}" FontSize="12" FontWeight="SemiBold" Margin="0,0,8,0"/>
                    <TextBox Background="{StaticResource BgHover}" Text="{Binding DeviceIpAddress, UpdateSourceTrigger=PropertyChanged, FallbackValue=localhost}" Style="{StaticResource ModernTextBox}" Width="140" Margin="0,0,20,0"/>

                    <TextBlock Text="Port" VerticalAlignment="Center" Foreground="{StaticResource TextSecondary}" FontSize="12" FontWeight="SemiBold" Margin="0,0,8,0"/>
                    <TextBox Background="{StaticResource BgHover}" Text="{Binding DevicePort, UpdateSourceTrigger=PropertyChanged, FallbackValue=8080}" Style="{StaticResource ModernTextBox}" Width="70" Margin="0,0,25,0"/>

                    <Button Command="{Binding ConnectCommand}" Style="{StaticResource PrimaryButton}" Margin="0,0,10,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="▶" Margin="0,1,8,0" FontSize="10"/>
                            <TextBlock Text="Connect"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding DisconnectCommand}" Style="{StaticResource GhostButton}" Margin="0,0,10,0" Foreground="{StaticResource ErrorColor}" BorderBrush="#FFEBEE">
                        <TextBlock Text="Stop" Foreground="Black" FontWeight="SemiBold"/>
                    </Button>

                    <Button Command="{Binding RefreshCommand}" Style="{StaticResource GhostButton}" Width="45" Padding="0" ToolTip="Reset Charts">
                        <TextBlock Text="↻" Foreground="Black" FontSize="18" FontWeight="Bold" Margin="0,-2,0,0"/>
                    </Button>

                </StackPanel>
            </Grid>
        </Border>

        <!-- 2. CONTENT AREA -->
        <Grid Grid.Row="1" Grid.ColumnSpan="2">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="15">
                <ItemsControl ItemsSource="{Binding SignalCards}">

                    <!-- PANEL DINÁMICO -->
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Columns="{Binding DataContext.GridColumns, RelativeSource={RelativeSource AncestorType=ItemsControl}}" 
                                         VerticalAlignment="Top" 
                                         IsItemsHost="True"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <!-- TARJETA (ITEM) -->
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{StaticResource BgCard}" 
                                    BorderThickness="1" 
                                    BorderBrush="{StaticResource BorderColor}"
                                    CornerRadius="8" 
                                    Margin="8" Height="auto"
                                    MinHeight="500"
                                    Effect="{StaticResource CardShadow}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <!-- Card Header -->
                                    <Grid Grid.Row="0" Margin="16,12">
                                        <StackPanel Orientation="Horizontal">
                                            <!-- Indicador de color circular -->
                                            <Ellipse Width="10" Height="10" Fill="{Binding Signal.Color}" Margin="0,0,10,0"/>
                                            <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="15" Foreground="{StaticResource TextPrimary}"/>
                                        </StackPanel>

                                        <!-- Checkbox de selección personalizado -->
                                        <ToggleButton IsChecked="{Binding IsSelected}" HorizontalAlignment="Right" Cursor="Hand">
                                            <ToggleButton.Template>
                                                <ControlTemplate TargetType="ToggleButton">
                                                    <Border x:Name="tb" Background="Transparent" BorderBrush="{StaticResource BorderColor}" BorderThickness="1" CornerRadius="4" Padding="8,4">
                                                        <TextBlock Width="auto" x:Name="txt" Text="Select" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsChecked" Value="True">
                                                            <Setter TargetName="tb" Property="Background" Value="{StaticResource AccentLight}"/>
                                                            <Setter TargetName="tb" Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                                                            <Setter TargetName="txt" Property="Foreground" Value="{StaticResource AccentColor}"/>
                                                            <Setter TargetName="txt" Property="Text" Value="Selected ✓"/>
                                                            <Setter TargetName="txt" Property="FontWeight" Value="Bold"/>
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="tb" Property="Background" Value="{StaticResource BgHover}"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </ToggleButton.Template>
                                        </ToggleButton>
                                    </Grid>

                                    <!-- Separador tenue -->
                                    <Border Grid.Row="0" VerticalAlignment="Bottom" Height="1" Background="{StaticResource BorderColor}" Opacity="0.5"/>

                                    <!-- Gráfico -->
                                    <views:SignalCard Grid.Row="1" Margin="10"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>

        <!-- 3. STATUS BAR -->
        <Border Grid.Row="2" Background="White" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,1,0,0" Padding="20,0" Grid.ColumnSpan="2">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse Width="8" Height="8" Fill="{Binding ConnectionStatusColor, FallbackValue=green}" Margin="0,0,10,0"/>
                    <TextBlock Text="{Binding ConnectionStatus, FallbackValue=Conected}" FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Border Background="{StaticResource BgHover}" CornerRadius="4" Padding="8,2" Margin="0,0,15,0">
                        <TextBlock Text="Render: 60 FPS" Foreground="{StaticResource TextSecondary}" FontSize="11" FontWeight="Bold"/>
                    </Border>
                    <TextBlock Text="{Binding LastUpdate, StringFormat='{}Updated: {0:HH:mm:ss},', FallbackValue=9999999}" Foreground="{StaticResource TextMuted}" FontSize="12" Margin="0,0,15,0"/>
                    <TextBlock Text="Developed by Danilo Da Cunha" Foreground="{StaticResource TextMuted}"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>